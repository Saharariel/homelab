apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: intel-gpu-plugin
  namespace: kube-system
spec:
  selector:
    matchLabels:
      name: intel-gpu-plugin
  template:
    metadata:
      labels:
        name: intel-gpu-plugin
    spec:
      # Target only worker-node-1
      nodeSelector:
        kubernetes.io/hostname: worker-node-1
      containers:
      - name: intel-gpu-plugin
        image: intel/intel-gpu-plugin:0.30.0
        imagePullPolicy: IfNotPresent
        # Move termination log to writable location
        terminationMessagePath: /var/log/termination-log
        terminationMessagePolicy: File
        securityContext:
          readOnlyRootFilesystem: true
          allowPrivilegeEscalation: false
        env:
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        volumeMounts:
        - name: devfs
          mountPath: /dev
          readOnly: true
        - name: sysfs
          mountPath: /sys
          readOnly: true
        - name: kubeletsockets
          mountPath: /var/lib/kubelet/device-plugins
        # Writable directories
        - name: var-log
          mountPath: /var/log
        - name: tmp
          mountPath: /tmp
      volumes:
      - name: devfs
        hostPath:
          path: /dev
      - name: sysfs
        hostPath:
          path: /sys
      - name: kubeletsockets
        hostPath:
          path: /var/lib/kubelet/device-plugins
      - name: var-log
        emptyDir: {}
      - name: tmp
        emptyDir: {}
